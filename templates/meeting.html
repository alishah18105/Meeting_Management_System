{% extends "MeetingDashboard.html" %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/meeting.css') }}">

<h2 class="dashboard-title">Meetings</h2>
<hr>


<!-- Quick Action Buttons (Zoom style) -->
<!-- Zoom-style Buttons -->
<div class="d-flex justify-content-around mb-4 flex-wrap">

  <!-- New Meeting -->
  <div class="d-flex flex-column align-items-center mx-3">
    <button class="zoom-btn zoom-orange" data-bs-toggle="modal" data-bs-target="#instantMeetingModal">
      <i class="bi bi-camera-video-fill"></i>
    </button>
    <span class="mt-2">New Meeting</span>
  </div>

  <!-- Join -->
  <div class="d-flex flex-column align-items-center mx-3">
  <!-- Trigger Modal -->
  <button class="zoom-btn zoom-blue" data-bs-toggle="modal" data-bs-target="#joinMeetingModal">
    <i class="bi bi-box-arrow-in-right"></i>
  </button>
  <span class="mt-2">Join</span>
</div>


  <!-- Schedule -->
  <div class="d-flex flex-column align-items-center mx-3">
    <button class="zoom-btn zoom-red" data-bs-toggle="modal" data-bs-target="#addMeetingModal">
      <i class="bi bi-calendar-plus"></i>
    </button>
    <span class="mt-2">Schedule</span>
  </div>

  <!-- Share Screen -->
  <div class="d-flex flex-column align-items-center mx-3">
    <button class="zoom-btn zoom-green">
      <i class="bi bi-display"></i>
    </button>
    <span class="mt-2">Share Screen</span>
  </div>
</div>

<!-- Add New Meeting Modal (Schedule) ------------------------------------------------------------------------------->
<div class="modal fade" id="addMeetingModal" tabindex="-1" aria-labelledby="addMeetingLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content modal-card">
      <form id="newMeetingForm" action="/meeting" method="POST">
        <div class="modal-header">
          <h5 class="modal-title" id="addMeetingLabel">Add New Meeting</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body p-3">
          <!-- Title + Room ID -->
          <div class="row g-3">
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">Meeting Title</label>
              <input type="text" class="form-control" name="title" required>
            </div>
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">Room ID</label>
              <input type="text" class="form-control" style="max-width: 80%;" name="room_id" required>
            </div>
          </div>

          <!-- Description -->
          <div class="row g-3 mt-2">
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="3"></textarea>
            </div>
          </div>

          <!-- Status -->
          <div class="row g-3 mt-2">
            <div class="col-12">
              <label class="form-label">Status</label>
              <select class="form-select" name="status">
                <option value="Scheduled">Scheduled</option>
                <option value="Ongoing">Ongoing</option>
                <option value="Completed">Completed</option>
                <option value="Canceled">Cancelled</option>
              </select>
            </div>
          </div>

          <!-- Start + End Date -->
          <div class="row g-3 mt-2">
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">Start Date & Time</label>
              <input type="datetime-local" class="form-control" style="max-width: 90%;" name="start_time" required>
            </div>
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">End Date & Time</label>
              <input type="datetime-local" class="form-control" style="max-width: 90%;" name="end_time" required>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Meeting</button>
        </div>
      </form>
    </div>
  </div>

</div>

<!----Add Instant Meeting Modal (New Meeting)--------------------------------------------------------------------------------->

<div class="modal fade" id="instantMeetingModal" tabindex="-1" aria-labelledby="instantMeetingModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content modal-card">
      <form id="instantMeetingForm" action="/instant_meeting" method="POST">
        <div class="modal-header">
          <h5 class="modal-title" id="instantMeetingModal">Create Instant  Meeting</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body p-3">
          <!-- Title + Room ID -->
          <div class="row g-3">
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">Meeting Title</label>
              <input type="text" class="form-control" name="title" required>
            </div>
            <div class="col-md-6 d-flex flex-column">
              <label class="form-label">Room ID</label>
              <input type="text" class="form-control" style="max-width: 80%;" name="room_id" required>
            </div>
          </div>

          <!-- Description -->
          <div class="row g-3 mt-2">
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="3"></textarea>
            </div>
          </div>


        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Start Meeting</button>
        </div>
      </form>
    </div>
  </div>

</div>
<!---------------------------------------------------------------------------------------------->


<!-- Join Meeting Modal ------------------------------------------------------------------------------->
<div class="modal fade" id="joinMeetingModal" tabindex="-1" aria-labelledby="joinMeetingLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content modal-card">
      <form id="joinMeetingForm" action="/join_meeting" method="POST">
        <div class="modal-header">
          <h5 class="modal-title" id="joinMeetingLabel">Join Meeting</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body p-3">
          <div class="row g-3">
            <div class="col-12 d-flex flex-column">
              <label class="form-label">Meeting ID</label>
              <input type="text" class="form-control" name="meeting_id" placeholder="e.g. 00025" required>
              <small class="text-white mt-1">Enter the 5-digit Meeting ID shared by the organizer.</small>

            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Join Meeting</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Hosted Meetings -->
<div class="mt-5 mb-4">
  <h5 class="meeting-subtitle">Hosted By You</h5>
  <hr>
</div>
<div class="meeting-cards-grid">
  {% for meeting in hosted_meetings %}
  {% if meeting.status != 'Completed' %}
  <div class="meeting-card position-relative"">
    <button 
  class="icon-btn border-0 bg-transparent position-absolute top-0 end-0 m-2 share-btn"
  data-meeting-id="{{ meeting.meeting_id }}"
  data-title="{{ meeting.title }}"
  data-start="{{ meeting.start_time.strftime('%b %d, %I:%M %p') }}"
  data-end="{{ meeting.end_time.strftime('%b %d, %I:%M %p') }}">
  <i class="bi bi-share-fill text-white" style="font-size: 1.2rem;"></i>
</button>
    
    <div class="meeting-header">
      <h5 class="meeting-title">{{ meeting.title }}</h5>
      <p class="meeting-time">
        {{ meeting.start_time.strftime("%b %d, %I:%M %p") }} -
        {{ meeting.end_time.strftime("%I:%M %p") }}
      </p>
    </div>
    <div class="meeting-body">
      <div class="meeting-tags">
        <span class="badge bg-light text-dark">{{ meeting.status }}</span>
        <span class="badge bg-light text-dark">
          {{ ((meeting.end_time - meeting.start_time).seconds // 3600) }} hrs
        </span>
        <span class="badge bg-light text-dark">Organizer</span>
      </div>
    </div>
    <div class="meeting-footer d-flex justify-content-between align-items-center">
      <div class="participants">
        <img src="https://i.pravatar.cc/32?img=1" class="rounded-circle" width="32" height="32">
        <img src="https://i.pravatar.cc/32?img=2" class="rounded-circle" width="32" height="32">
        <span class="text-white">+5</span>
      </div>
      <a href="#" class="btn join-btn">Join Meeting</a>
      <button class="btn join-btn" data-bs-toggle="modal" data-bs-target="#editMeetingModal{{meeting.meeting_id}}">
        Edit
      </button>
    </div>
  </div>

  <div class="modal fade" id="editMeetingModal{{meeting.meeting_id}}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content modal-card">
        <form action="/update_meeting/{{meeting.meeting_id}}" method="POST">
          <div class="modal-header">
            <h5 class="modal-title">Edit Meeting</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body p-3">
            <!-- Title + Room ID -->
            <div class="row g-3">
              <div class="col-md-6 d-flex flex-column">
                <label class="form-label">Meeting Title</label>
                <input type="text" class="form-control" name="title" value="{{meeting.title}}" required>
              </div>
              <div class="col-md-6 d-flex flex-column">
                <label class="form-label">Room ID</label>
                <input type="text" class="form-control" name="room_id" value="{{meeting.room_id}}" required>
              </div>
            </div>

            <!-- Description -->
            <div class="row g-3 mt-2">
              <div class="col-12">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="description" rows="3">{{ meeting.description }}</textarea>
              </div>
            </div>

            <!-- Status -->
            <div class="row g-3 mt-2">
              <div class="col-12">
                <label class="form-label">Status</label>
                <select class="form-select" name="status">
                  <option value="Scheduled" {% if meeting.status=="Scheduled" %}selected{% endif %}>Scheduled</option>
                  <option value="Completed" {% if meeting.status=="Completed" %}selected{% endif %}>Completed</option>
                  <option value="Canceled" {% if meeting.status=="Canceled" %}selected{% endif %}>Canceled</option>
                </select>
              </div>
            </div>

            <!-- Start + End Date -->
            <div class="row g-3 mt-2">
              <div class="col-md-6 d-flex flex-column">
                <label class="form-label">Start Date & Time</label>
                <input type="datetime-local" class="form-control"
                  name="start_time"
                  value="{{ meeting.start_time.strftime('%Y-%m-%dT%H:%M') }}" required>
              </div>
              <div class="col-md-6 d-flex flex-column">
                <label class="form-label">End Date & Time</label>
                <input type="datetime-local" class="form-control"
                  name="end_time"
                  value="{{ meeting.end_time.strftime('%Y-%m-%dT%H:%M') }}" required>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Update Meeting</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endif %}
  {% else %}
  <p class="text-muted">You haven’t hosted any meetings yet.</p>
  {% endfor %}

  <!-- Share Meeting Modal -->
<div class="modal fade" id="shareMeetingModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content modal-card">
      <div class="modal-header">
        <h5 class="modal-title">Share Meeting Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea id="shareText" class="form-control" rows="5" readonly></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-primary" id="copyShareText">Copy</button>
      </div>
    </div>
  </div>
</div>

</div>


<!-- Joined Meetings -->
<div class="mt-5 mb-4">
  <h5 class="meeting-subtitle">Joined Meetings</h5>
  <hr>
</div>
<div class="meeting-cards-grid">
  {% for meeting in joined_meetings %}
  <div class="meeting-card">
    <div class="meeting-header">
      <h5 class="meeting-title">{{ meeting.title }}</h5>
      <p class="meeting-time">
        {{ meeting.start_time.strftime("%b %d, %I:%M %p") }} -
        {{ meeting.end_time.strftime("%I:%M %p") }}
      </p>
    </div>
    <div class="meeting-body">
      <div class="meeting-tags">
        <span class="badge bg-light text-dark">{{ meeting.status }}</span>
        <span class="badge bg-light text-dark">
          {{ ((meeting.end_time - meeting.start_time).seconds // 3600) }} hrs
        </span>
        <span class="badge bg-light text-dark">Participant</span>
      </div>
    </div>
    <div class="meeting-footer d-flex justify-content-between align-items-center">
      <div class="participants">
        <img src="https://i.pravatar.cc/32?img=3" class="rounded-circle" width="32" height="32">
        <img src="https://i.pravatar.cc/32?img=4" class="rounded-circle" width="32" height="32">
        <span class="text-white">+3</span>
      </div>
      <a href="#" class="btn join-btn">View Details</a>
    </div>
  </div>
  {% else %}
  <p class="text-muted">You haven’t joined any meetings yet.</p>
  {% endfor %}
</div>



<script>
document.addEventListener("DOMContentLoaded", function () {
  const shareButtons = document.querySelectorAll(".share-btn");
  const shareModal = new bootstrap.Modal(document.getElementById("shareMeetingModal"));
  const shareTextArea = document.getElementById("shareText");
  const copyBtn = document.getElementById("copyShareText");

  shareButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.dataset.meetingId;
      const title = btn.dataset.title;
      const start = btn.dataset.start;
      const end = btn.dataset.end;

      // Calculate duration (simple way)
      const startTime = new Date(start);
      const endTime = new Date(end);
      const duration = ((endTime - startTime) / (1000 * 60 * 60)).toFixed(1) + " hrs";

      const text = `Meeting ID: ${id}\nTitle: ${title}\nStart Time: ${start}\nDuration: ${duration}`;
      shareTextArea.value = text;

      shareModal.show();
    });
  });

  copyBtn.addEventListener("click", () => {
    shareTextArea.select();
    document.execCommand("copy");
    copyBtn.textContent = "Copied!";
    setTimeout(() => (copyBtn.textContent = "Copy"), 1500);
  });
});
</script>



{% endblock %}